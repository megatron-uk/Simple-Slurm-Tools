### lib/slurmcache.py

#### Purpose

This file contains functions which store and load slurm data (from calls to *sacct* and similar) to/from disk.

#### Classes

**slurmCache()**

e.g. sc = slurmCache()

No initialisation parameters are supported.

All functions shown here are member functions of the slurmCache class.

---

#### Functions

##### hashcode()

Params: 

   * None

Returns:

   * MD5 fingerprint of the on-disk state of the *slurmjob.py* module.

Description:

   * The first time this function is called it reads the content of the lib/slurmjob.py module from disk and produces an MD5 hexdigest. This is performed to detect possible changes in function calls to sacct; any change to the content of *slurmjob.py* will change the module fingerprint and any existing on-disk cache files will no longer be loaded (since they will have a different filename).

Example:

        c = sc.hashcode()
        print(c)
        '1703d1a3beb0502dfca9fcc6ed63a592'

---

##### hashkey()

Params: 

   * year = 0
   * month = 0
   * day = 0
   * hours = 0
   * minutes = 0
   * key = ""

Returns:

   * A unique MD5 fingerprint consisting of the output from hashcode() as well as the unique parameters set in the request (e.g. date/time as well as any arbitrary string set in *key*).

Description:

   * Produces a unique string which is used for naming on-disk cache files based on the date/time of the function call, or some other arbitrary parameters (e.g. 'CD' job state compared to 'PD'). This function is called by all of the load/store functions to generate a consistent file naming scheme based on the parameters given. The output of hashcode() is used as a prefix to the unique key generated by this function.

Example:

        k = sc.hashcode(date = 29, month = 11, year = 2023, hours = 9, minutes = 59, key = "user_jobs)
        print(k)
        '1703d1a3beb0502dfca9fcc6ed63a592-fa4689c908f1bb7f780fe37bbc38aa72'
---

##### store()

Params: 

   * year = 0
   * month = 0
   * day = 0
   * hours = 0
   * minutes = 0
   * key = ""

Returns:

   * True on storing the cache data on disk, otherwise False.

Description:

   * Turns a Python dictionary of data into a json object and stores it on disk with a persistent, unique filename against a given set of date/time fields. Internally calls hashkey() to generate consistent filenames.

        mydict = { jobs: [.......] }
        result = sc.store(year = 29, month = 11, year = 2023, hours = 9, minutes = 59, key = "user_jobs", data = mydict)
        print(result)
        True

---

##### storecmd()

Params: 

   * key = ""
   * data = ""

Returns:

   * True on storing the cache data on disk, otherwise False.

Description:

   * Turns a Python dictionary of data into a json object and stores it on disk with a persistent, unique filename using a text key only (no date/time fields in the description). Internally calls hashkey() to generate consistent filenames.

        mydict = { these_jobs: [.......] }
        result = sc.store(key = "user_jobs", data = mydict)
        print(result)
        True

---

##### load()

Params: 

   * year = 0
   * month = 0
   * day = 0
   * hours = 0
   * minutes = 0
   * key = ""

Returns:

   * Python data structure if loaded from disk, otherwise False.

Description:

   * Loads a previously cached python object from disk, if present, using the persistent, unique filename against a given set of date/time fields. Internally calls hashkey() to generate consistent filenames.

Example:

        mydict = sc.load(year = 29, month = 11, year = 2023, hours = 9, minutes = 59, key = "user_jobs")
        print(mydict)
        { jobs: [.......] }

---

##### loadcmd()

Params: 

   * key = ""

Returns:

   * Python data structure if loaded from disk, otherwise False.

Description:

   * Loads a previously cached python object from disk, if present, using the persistent, unique filename using a text key only (no date/time fields in the description). Internally calls hashkey() to generate consistent filenames.

Example:

        mydict = sc.load(key = "user_jobs")
        print(mydict)
        { these_jobs: [.......] }

---